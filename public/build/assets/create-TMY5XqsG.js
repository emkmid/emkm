import{u as E,r as B,j as e,H as K,L as N}from"./app-CbSvBRR6.js";import{A as Q}from"./app-layout-DPIu9NHR.js";import{B as o}from"./button-D8YY9zMZ.js";import{C as x,d as u,a as f,b,c as T}from"./card-CRaaDakb.js";import{I as d}from"./input-DyzkBuLN.js";import{L as m}from"./label-DNTvZZUk.js";import{T as H}from"./textarea-zRs34nKr.js";import{S as $,a as J,b as M,c as U,d as V}from"./select-CgCtBDfg.js";import{T as O,a as G,b as P,c as p,d as W,e as j}from"./table-CWhtiGuq.js";import{Q as X}from"./feature-limits-CN0xyCkc.js";import{A as Y}from"./arrow-left-BPNiM2RR.js";import{P as Z}from"./plus-Dih4mLd6.js";import{T as q}from"./trash-2-BrTvDoqs.js";import{S as ee}from"./save-BeFr3_pE.js";import"./index-D6Iz_25J.js";import"./index-jocU-0uu.js";import"./index-CUEw2yDK.js";import"./createLucideIcon-Cu_qVhsr.js";import"./index-pX9j0-RB.js";import"./index-PgtCgqs6.js";import"./index-w35fd-b3.js";import"./book-open-Cm83PIlw.js";import"./chevron-down-LJnJPqnW.js";import"./check-CN90inkJ.js";import"./alert-B8jBwCzJ.js";import"./badge-BK7dcg4p.js";import"./circle-alert-BVuBfK7X.js";import"./arrow-right-Dyw0pAtP.js";import"./lock-DC4qPwOZ.js";function Fe({customers:v,quota:i}){const{data:r,setData:l,post:A,processing:F,errors:a}=E({customer_id:"",invoice_date:new Date().toISOString().split("T")[0],due_date:"",tax_rate:"0",discount_amount:"0",notes:"",terms:"",items:[]}),[n,y]=B.useState([{id:Math.random().toString(),description:"",quantity:1,unit_price:0,amount:0}]),_=n.reduce((s,t)=>s+t.amount,0),D=typeof r.tax_rate=="string"?parseFloat(r.tax_rate):0,C=_*D/100,w=typeof r.discount_amount=="string"?parseFloat(r.discount_amount):0,L=_+C-w;B.useEffect(()=>{l("items",n)},[n]);const R=()=>{y([...n,{id:Math.random().toString(),description:"",quantity:1,unit_price:0,amount:0}])},z=s=>{n.length>1&&y(n.filter(t=>t.id!==s))},S=(s,t,c)=>{y(n.map(k=>{if(k.id===s){const g={...k,[t]:c};return(t==="quantity"||t==="unit_price")&&(g.amount=parseFloat(g.quantity.toString()||"0")*parseFloat(g.unit_price.toString()||"0")),g}return k}))},I=(s,t="draft")=>{s.preventDefault(),A(route("invoices.store",{status:t}))},h=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s);return e.jsxs(Q,{children:[e.jsx(K,{title:"Buat Invoice"}),e.jsxs("div",{className:"container max-w-6xl mx-auto py-6 space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{variant:"ghost",size:"sm",asChild:!0,className:"mb-2",children:e.jsxs(N,{href:route("invoices.index"),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Kembali"]})}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Buat Invoice"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Buat invoice baru untuk customer"})]}),i&&e.jsx(x,{className:"sm:w-auto",children:e.jsx(u,{className:"pt-6",children:e.jsx(X,{current:i.current,limit:i.limit,remaining:i.remaining,isUnlimited:i.is_unlimited,featureName:"Invoice"})})})]}),i&&!i.is_unlimited&&i.remaining<=5&&i.remaining>0&&e.jsx(x,{className:"border-amber-200 bg-amber-50",children:e.jsx(u,{className:"pt-4",children:e.jsxs("p",{className:"text-sm text-amber-800",children:["⚠️ Hanya ",i.remaining," invoice tersisa bulan ini.",e.jsx(N,{href:route("packages.index"),className:"ml-2 underline font-medium",children:"Upgrade ke Pro untuk unlimited invoice"})]})})})]}),e.jsx("form",{onSubmit:s=>I(s),children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(x,{children:[e.jsxs(f,{children:[e.jsx(b,{children:"Informasi Invoice"}),e.jsx(T,{children:"Pilih customer dan tanggal invoice"})]}),e.jsx(u,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{htmlFor:"customer_id",children:["Customer ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs($,{value:r.customer_id,onValueChange:s=>l("customer_id",s),children:[e.jsx(J,{className:a.customer_id?"border-red-500":"",children:e.jsx(M,{placeholder:"Pilih customer"})}),e.jsx(U,{children:v.map(s=>e.jsx(V,{value:s.id.toString(),children:s.display_name},s.id))})]}),a.customer_id&&e.jsx("p",{className:"text-sm text-red-500",children:a.customer_id}),v.length===0&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Belum ada customer."," ",e.jsx(N,{href:route("customers.create"),className:"text-primary hover:underline",children:"Tambah customer"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{htmlFor:"invoice_date",children:["Tanggal Invoice ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{id:"invoice_date",type:"date",value:r.invoice_date,onChange:s=>l("invoice_date",s.target.value),className:a.invoice_date?"border-red-500":""}),a.invoice_date&&e.jsx("p",{className:"text-sm text-red-500",children:a.invoice_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{htmlFor:"due_date",children:["Jatuh Tempo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{id:"due_date",type:"date",value:r.due_date,onChange:s=>l("due_date",s.target.value),className:a.due_date?"border-red-500":""}),a.due_date&&e.jsx("p",{className:"text-sm text-red-500",children:a.due_date})]})]})})]}),e.jsxs(x,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(b,{children:"Item Invoice"}),e.jsx(T,{children:"Tambahkan produk atau layanan"})]}),e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:R,children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Tambah Item"]})]})}),e.jsxs(u,{children:[e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(O,{children:[e.jsx(G,{children:e.jsxs(P,{children:[e.jsx(p,{className:"min-w-[250px]",children:"Deskripsi"}),e.jsx(p,{className:"w-[100px]",children:"Qty"}),e.jsx(p,{className:"w-[150px]",children:"Harga Satuan"}),e.jsx(p,{className:"w-[150px] text-right",children:"Jumlah"}),e.jsx(p,{className:"w-[50px]"})]})}),e.jsx(W,{children:n.map((s,t)=>e.jsxs(P,{children:[e.jsx(j,{children:e.jsx(d,{placeholder:"Nama produk/layanan",value:s.description,onChange:c=>S(s.id,"description",c.target.value),className:a[`items.${t}.description`]?"border-red-500":""})}),e.jsx(j,{children:e.jsx(d,{type:"number",min:"1",value:s.quantity,onChange:c=>S(s.id,"quantity",parseFloat(c.target.value)),className:a[`items.${t}.quantity`]?"border-red-500":""})}),e.jsx(j,{children:e.jsx(d,{type:"number",min:"0",step:"0.01",value:s.unit_price,onChange:c=>S(s.id,"unit_price",parseFloat(c.target.value)),className:a[`items.${t}.unit_price`]?"border-red-500":""})}),e.jsx(j,{className:"text-right font-medium",children:h(s.amount)}),e.jsx(j,{children:e.jsx(o,{type:"button",variant:"ghost",size:"icon",onClick:()=>z(s.id),disabled:n.length===1,children:e.jsx(q,{className:"h-4 w-4 text-red-500"})})})]},s.id))})]})}),a.items&&e.jsx("p",{className:"text-sm text-red-500 mt-2",children:a.items})]})]}),e.jsxs(x,{children:[e.jsxs(f,{children:[e.jsx(b,{children:"Catatan & Syarat"}),e.jsx(T,{children:"Informasi tambahan (opsional)"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"notes",children:"Catatan"}),e.jsx(H,{id:"notes",placeholder:"Catatan untuk customer...",value:r.notes,onChange:s=>l("notes",s.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"terms",children:"Syarat & Ketentuan"}),e.jsx(H,{id:"terms",placeholder:"Syarat pembayaran...",value:r.terms,onChange:s=>l("terms",s.target.value),rows:3})]})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(x,{className:"sticky top-6",children:[e.jsx(f,{children:e.jsx(b,{children:"Ringkasan"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"tax_rate",children:"Pajak (%)"}),e.jsx(d,{id:"tax_rate",type:"number",min:"0",max:"100",step:"0.01",value:r.tax_rate,onChange:s=>l("tax_rate",s.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"discount_amount",children:"Diskon (Rp)"}),e.jsx(d,{id:"discount_amount",type:"number",min:"0",step:"0.01",value:r.discount_amount,onChange:s=>l("discount_amount",s.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsx("span",{className:"font-medium",children:h(_)})]}),C>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Pajak (",D,"%)"]}),e.jsx("span",{className:"font-medium",children:h(C)})]}),w>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Diskon"}),e.jsxs("span",{className:"font-medium text-red-600",children:["-",h(w)]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Total"}),e.jsx("span",{className:"text-2xl font-bold text-primary",children:h(L)})]})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t",children:[e.jsxs(o,{type:"submit",className:"w-full",disabled:F||v.length===0,onClick:s=>I(s,"sent"),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Simpan & Kirim"]}),e.jsx(o,{type:"submit",variant:"outline",className:"w-full",disabled:F||v.length===0,onClick:s=>I(s,"draft"),children:"Simpan sebagai Draft"}),e.jsx(o,{type:"button",variant:"ghost",className:"w-full",asChild:!0,children:e.jsx(N,{href:route("invoices.index"),children:"Batal"})})]})]})]})})]})})]})]})}export{Fe as default};
