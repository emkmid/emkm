import{r as c,j as e,H as x}from"./app-DMzlbMlc.js";import{B as m}from"./button-ClZVX0YR.js";import{C as j,a as g,b as y,d as b}from"./card-KbR_jJnN.js";import{A as w}from"./app-layout-m_YmtBV-.js";import"./index-Bw1SYNaQ.js";import"./index-IJ6B3_XY.js";import"./createLucideIcon-DgByKg4k.js";import"./index-DYoJGl24.js";import"./index-D6EfXmOo.js";import"./book-open-5Dsmw6bw.js";function k({packageId:o}){const[r,t]=c.useState(!1),u=async()=>{var l;t(!0);try{const n=await fetch("/subscriptions/checkout",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"))||""},body:JSON.stringify({package_id:o})});if(n.status===401){window.location.href="/login";return}const f=n.headers.get("content-type")||"";if(!n.ok&&f.includes("text/html")){window.location.href="/login";return}const a=await n.json();if(a.snap_token){const d=a.client_key,p=a.is_production?`https://app.midtrans.com/snap/snap.js?client-key=${d}`:`https://app.sandbox.midtrans.com/snap/snap.js?client-key=${d}`;await new Promise((s,h)=>{if(window.snap||document.querySelector(`script[src="${p}"]`))return s();const i=document.createElement("script");i.src=p,i.onload=()=>s(),i.onerror=()=>h(new Error("Failed to load Midtrans Snap script")),document.head.appendChild(i)}),window.snap.pay(a.snap_token,{onSuccess:function(s){alert("Pembayaran berhasil. Terima kasih!"),window.location.reload()},onPending:function(s){alert("Pembayaran pending. Silakan selesaikan pembayaran."),window.location.reload()},onError:function(s){alert("Terjadi kesalahan pada pembayaran.")},onClose:function(){}})}else a.manual?alert("Subscription created (manual)."):a.url?window.location.href=a.url:alert("Unexpected response from server")}catch(n){console.error(n),alert("Failed to start checkout")}finally{t(!1)}};return e.jsx(m,{onClick:u,disabled:r,size:"sm",children:r?"Processing...":"Subscribe"})}function S(){const[o,r]=c.useState([]);return c.useEffect(()=>{fetch("/packages").then(t=>t.json()).then(r).catch(console.error)},[]),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:o.map(t=>e.jsxs(j,{children:[e.jsx(g,{children:e.jsx(y,{children:t.name})}),e.jsxs(b,{children:[e.jsx("div",{className:"mb-4 text-sm text-muted-foreground",children:t.description}),e.jsxs("div",{className:"mb-4 text-lg font-semibold",children:["$",t.price]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{packageId:t.id}),e.jsx(m,{variant:"ghost",children:"Details"})]})]})]},t.id))})}function F(){return e.jsxs(w,{children:[e.jsx(x,{title:"Paket Layanan"}),e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"mb-4 text-2xl font-bold",children:"Paket Layanan"}),e.jsx(S,{})]})]})}export{F as default};
