import{r as c,j as e}from"./app-BNBXPyAp.js";import{B as u}from"./button-CG4I0rhr.js";import{C as x,a as g,b,d as j}from"./card-lfiC7PRw.js";function w({packageId:i}){const[r,t]=c.useState(!1),m=async()=>{var d;t(!0);try{const a=await fetch("/subscriptions/checkout",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((d=document.querySelector('meta[name="csrf-token"]'))==null?void 0:d.getAttribute("content"))||""},body:JSON.stringify({package_id:i})});if(a.status===401){window.location.href="/login";return}const h=a.headers.get("content-type")||"";if(!a.ok&&h.includes("text/html")){window.location.href="/login";return}const n=await a.json();if(n.snap_token){const l=n.client_key,p=n.is_production?`https://app.midtrans.com/snap/snap.js?client-key=${l}`:`https://app.sandbox.midtrans.com/snap/snap.js?client-key=${l}`;await new Promise((s,f)=>{if(window.snap||document.querySelector(`script[src="${p}"]`))return s();const o=document.createElement("script");o.src=p,o.onload=()=>s(),o.onerror=()=>f(new Error("Failed to load Midtrans Snap script")),document.head.appendChild(o)}),window.snap.pay(n.snap_token,{onSuccess:function(s){alert("Pembayaran berhasil. Terima kasih!"),window.location.reload()},onPending:function(s){alert("Pembayaran pending. Silakan selesaikan pembayaran."),window.location.reload()},onError:function(s){alert("Terjadi kesalahan pada pembayaran.")},onClose:function(){}})}else n.manual?alert("Subscription created (manual)."):n.url?window.location.href=n.url:alert("Unexpected response from server")}catch(a){console.error(a),alert("Failed to start checkout")}finally{t(!1)}};return e.jsx(u,{onClick:m,disabled:r,size:"sm",children:r?"Processing...":"Subscribe"})}function P(){const[i,r]=c.useState([]);return c.useEffect(()=>{fetch("/packages").then(t=>t.json()).then(r).catch(console.error)},[]),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:i.map(t=>e.jsxs(x,{children:[e.jsx(g,{children:e.jsx(b,{children:t.name})}),e.jsxs(j,{children:[e.jsx("div",{className:"mb-4 text-sm text-muted-foreground",children:t.description}),e.jsxs("div",{className:"mb-4 text-lg font-semibold",children:["$",t.price]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{packageId:t.id}),e.jsx(u,{variant:"ghost",children:"Details"})]})]})]},t.id))})}export{P};
